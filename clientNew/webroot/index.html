<!doctype html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>AngryGophers TANK</title>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
          type="text/javascript"></script>
</head>
<body>
  <section>
    <h1> Testing this blad≈∫!</h1>
    <div id="test">
      wtf
    </div>

    <div id="newSession">
        Podaj nick czopku: <input id="nickName" name="nick">
        <button id="submitNick">
          Send
        </button>
    </div>
    <script type="text/javascript">
      var keySpacePressed = false;
      var keyUpPressed = false;
      var keyDownPressed = false;
      var keyLeftPressed = false;
      var keyRightPressed = false;

      var websocket = new WebSocket("ws://localhost:8080/echo");
      websocket.onmessage = function(str)
      {
        //document.getElementById('test').innerHTML += str.data + "<br />";
      };

      function websocketAction(action)
      {
        websocket.send(action);
      }


      function doKeyDown(evt) {
        switch (evt.keyCode) {
          case 32:
            if (!keySpacePressed) {
              // pressed.push("fire");
              keySpacePressed = true;
              // websocketAction("fire");
              websocketAction('fire');
            }
            break;
          case 38:
            if (!keyUpPressed) {
              keyUpPressed = true;
              websocketAction("up");
            }
          break;
          case 40:  /* Down arrow */
            if (!keyDownPressed) {
              keyDownPressed = true;
              websocketAction("down");
            }
          break;
          case 37:  /* Left arrow was pressed */
            if (!keyLeftPressed) {
              keyLeftPressed = true;
              websocketAction("left");
            }
          break;
          case 39:  /* Right arrow was pressed */
            if (!keyRightPressed) {
              keyRightPressed = true;
              websocketAction("right");
            }
          break;
        }
      }

      function doKeyUp(evt) {
        var direction;
        switch (evt.keyCode) {
          case 32:
            if (keySpacePressed) {
              // direction = "fire2";
              websocketAction('fire2');
              // removePressed('fire');
              keySpacePressed = false;
            }
          break;
          case 38:
            if (keyUpPressed) {
              websocketAction('up2');
              keyUpPressed = false;
            }
          break;
          case 40:  /* Down arrow was pressed */
            if (keyDownPressed) {
              websocketAction('down2');
              keyDownPressed = false;
            }
          break;
          case 37:  /* Left arrow was pressed */
            if (keyLeftPressed) {
              websocketAction('left2');
              keyLeftPressed = false;
            }
          break;
          case 39:  /* Right arrow was pressed */
            if (keyRightPressed) {
              websocketAction('right2');
              keyRightPressed = false;
            }
          break;
        }
      }

      window.addEventListener('keydown',doKeyDown, true);
      window.addEventListener('keyup', doKeyUp, true);

      $(function() {
        $("#submitNick").click(function() {
          websocketAction("login:" + $('#nickName').val());
          $('#newSession').hide();
        });
      });

      </script>
    </section>
</body>
</html>